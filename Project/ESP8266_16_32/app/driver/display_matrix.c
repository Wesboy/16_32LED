#include "display_matrix.h"
#include "fontcode.h"

static uint8_t iRow[] = {0x01,0x02, 0x03,0x04, 0x5, 0x6, 0x7, 0x8};

void ICACHE_FLASH_ATTR display_init(void)
{
	max7219_init();

	max7219_clear();
	max7219_setBrightness(0);
	max7219_full();
}


uint8_t x = 0,y = 1;
uint8_t code[16][4] =
{
	0x00,0x00,0x20,0x80,
	0x7F,0xFC,0x20,0x80,
	0x00,0x00,0x47,0xF8,
	0x00,0x00,0x90,0x80,
	0x3E,0xF8,0xF0,0x80,
	0x22,0x88,0x24,0x90,
	0x22,0x88,0x44,0x90,
	0x32,0xC8,0x84,0x90,
	0x2A,0xA8,0xF7,0xF0,
	0x2A,0xA8,0x00,0x80,
	0x22,0x88,0x00,0x80,
	0x22,0x88,0x30,0x88,
	0x22,0x88,0xC0,0x88,
	0x2E,0xB8,0x00,0x78,
	0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,
};

uint8_t wuliao[16][4] = {
	0x00,0x00,0x00,0x80,
	0x3F,0xF8,0xFB,0x38,
	0x01,0x00,0x52,0xA8,
	0x01,0x00,0x52,0xA8,
	0x01,0x00,0x72,0xA8,
	0x01,0x00,0x52,0xA8,
	0x7F,0xFC,0x52,0xA8,
	0x02,0x80,0x72,0xA8,
	0x02,0x80,0x52,0xA8,
	0x04,0x80,0x53,0xA8,
	0x08,0x80,0x5A,0xB8,
	0x10,0x84,0xF0,0xA0,
	0x20,0x84,0x11,0x20,
	0x40,0x7C,0x12,0x20,
	0x00,0x00,0x00,0x00,
};

void uint8_to_uin32_t(uint8_t iLine, uint32_t *val)
{
	*val = wuliao[iLine][0]<<24;
	*val |= wuliao[iLine][1]<<16;
	*val |= wuliao[iLine][2]<<8;
	*val |= wuliao[iLine][3]&0xFF;
}

void ICACHE_FLASH_ATTR display_pro(void *arg)
{
	static uint8_t i = 4;
	static uint32_t val = 0x80000000;
	static uint32_t val_tmp = 0;
	static uint8_t offset = 0;
	max7219_clear();
	val = 0;

	for(i = 0; i < 16; i++)
	{
		uint8_to_uin32_t(i, &val);
		val_tmp = val << (32-offset);
		val >>= offset;
		val |= val_tmp;
		max7219_16_32_scan(i+1, val);
	}
	if(offset < 32)
		offset++;
	else
		offset = 0;

	os_printf("display type%x \r\n", val);

}
